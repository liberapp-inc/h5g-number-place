function randInt(){return globalRandom["int"]()}function rand01(){return globalRandom.f01()}function randF(t,e){return globalRandom.f(t,e)}function randI(t,e){return globalRandom.i(t,e)}function randBool(t){return void 0===t&&(t=.5),globalRandom.bool(t)}var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);o.prototype=e.prototype,t.prototype=new o},__awaiter=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function a(t){try{l(n.next(t))}catch(e){r(e)}}function s(t){try{l(n["throw"](t))}catch(e){r(e)}}function l(t){t.done?i(t.value):new o(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function o(t){return function(e){return n([t,e])}}function n(o){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){l.label=o[1];break}if(6===o[0]&&l.label<a[1]){l.label=a[1],a=o;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(o);break}a[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(n){o=[6,n],r=0}finally{i=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var i,r,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},GameObject=function(){function t(){this.display=null,t.objects.push(this)}return Object.defineProperty(t.prototype,"X",{get:function(){return this.display.x},set:function(t){this.display.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Y",{get:function(){return this.display.y},set:function(t){this.display.y=t},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.baseDisplay=e,t.gameDisplay=new egret.DisplayObjectContainer,t.baseDisplay.addChild(t.gameDisplay)},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t._delete(),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t._delete(),!1})},t.prototype._delete=function(){this.onDestroy(),this.display&&(this.display.parent.removeChild(this.display),this.display=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return Util.initial(this),GameObject.initial(this.stage),Camera2D.initial(),SceneTitle.loadScene(),egret.startTick(this.tickLoop,this),[2]})})},e.prototype.tickLoop=function(t){return GameObject.process(),Camera2D.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var SaveKeyBestScore="numpla-bestScore",DefaultBestScore=50,BackColor=16317180,FontColor=1052688,Font2Color=13631488,BoxColor=15790320,RelateBoxColor=12640496,SelectBoxColor=15777920,BoxCount=9,BoxSizeInW=10,BoxSizeInH=15,BoxWpw=1/BoxSizeInW,BoxHph=1/BoxSizeInH,KeyInW=8,KeyInH=12,KeyWpw=1/KeyInW,KeyHph=1/KeyInH,Game=function(t){function e(){var o=t.call(this)||this;o.counter=0,o.localTouchBegan=!1,o.press=!1,o.touch=!1,o.tapX=0,o.tapY=0,o.boxes=[],o.keys=[],o.initialNumbs=[],o.numbs=[],o.notes=[],o.currentBoxID=-1,o.touchedBoxID=-1,o.touchedKeyID=-1,e.I=o;for(var n=0;BoxCount>n;n++)for(var i=0;BoxCount>i;i++){var r=n+i*BoxCount,a=e.initialData[r],s=parseInt(a);o.initialNumbs[r]=s,o.numbs[r]=s,o.notes[r]=0,0==s&&(a="");var l=.5+(n-4)*BoxWpw,c=.35+(i-4)*BoxHph,u=0!=s;o.boxes[r]=new Button(a,34,FontColor,l,c,.9*BoxWpw,.9*BoxHph,BoxColor,1,Font2Color,u,function(t){return o.onBox(t)},o,r)}for(var n=0;3>n;n++)for(var i=0;3>i;i++){var r=1+n+3*i,a=r.toFixed(),l=.5+(n-1)*KeyWpw,c=.8+(i-1)*KeyHph;o.keys[r]=new Button(a,40,FontColor,l,c,.9*KeyWpw,.9*KeyHph,BoxColor,1,Font2Color,!0,function(t){return o.onKey(t)},o,r)}return o}return __extends(e,t),e.prototype.onBox=function(t){this.touchedBoxID=t.keyId},e.prototype.onKey=function(t){this.touchedKeyID=t.keyId},e.prototype.onDestroy=function(){e.I=null},e.prototype.update=function(){if(null==GameOver.I){if(this.touchedBoxID>=0){this.currentBoxID>=0&&(this.boxes[this.currentBoxID].setColor(BoxColor),this.boxes[this.currentBoxID].setTextColor(FontColor)),this.currentBoxID=this.touchedBoxID;var t=this.currentBoxID%BoxCount,e=Math.floor(this.currentBoxID/BoxCount);this.setRelateBoxColor(t,e),this.setRelateTextColor(t,e),this.boxes[this.currentBoxID].setColor(SelectBoxColor)}if(this.touchedKeyID>=0&&this.currentBoxID>=0&&0==this.initialNumbs[this.currentBoxID]){this.numbs[this.currentBoxID]=this.touchedKeyID,this.boxes[this.currentBoxID].setText(this.touchedKeyID.toFixed(),!1);var t=this.currentBoxID%BoxCount,e=Math.floor(this.currentBoxID/BoxCount);this.setRelateTextColor(t,e),this.checkNumber(t,e)?this.boxes[this.currentBoxID].setTextColor(FontColor):this.boxes[this.currentBoxID].setTextColor(16711680),this.checkClear()&&new GameOver}this.touchedBoxID=-1,this.touchedKeyID=-1}},e.prototype.setRelateBoxColor=function(t,e){for(var o=(this.numbs[t+e*BoxCount],3*Math.floor(t/3)),n=3*Math.floor(e/3),i=0;BoxCount>i;i++)for(var r=0;BoxCount>r;r++){var a=i+r*BoxCount,s=i>=o&&o+2>=i&&r>=n&&n+2>=r;s||i==t||r==e?this.boxes[a].setColor(RelateBoxColor):this.boxes[a].setColor(BoxColor)}},e.prototype.setRelateTextColor=function(t,e){for(var o=this.numbs[t+e*BoxCount],n=0;BoxCount>n;n++)for(var i=0;BoxCount>i;i++){var r=n+i*BoxCount;this.numbs[r]==o?this.boxes[r].setTextColor(16711680):this.boxes[r].setTextColor(FontColor)}},e.prototype.checkNumber=function(t,e){for(var o=this.numbs[t+e*BoxCount],n=0;BoxCount>n;n++)if(n!=t&&this.numbs[n+e*BoxCount]==o)return!1;for(var i=0;BoxCount>i;i++)if(i!=e&&this.numbs[t+i*BoxCount]==o)return!1;for(var r=3*Math.floor(t/3),a=3*Math.floor(e/3),n=0;3>n;n++)for(var i=0;3>i;i++){var s=r+n,l=a+i;if(s!=t&&l!=e&&this.numbs[s+l*BoxCount]==o)return!1}return!0},e.prototype.checkClear=function(){for(var t=0;t<this.numbs.length;t++)if(0==this.numbs[t])return!1;for(var t=0;BoxCount>t;t++)for(var e=0;BoxCount>e;e++){var o=t+e*BoxCount;if(0==this.initialNumbs[o]&&0==this.checkNumber(t,e))return!1}return!0},e.initialData="008000010041700293293540070036900000007000800000005740080072961614009520070000300",e}(GameObject);__reflect(Game.prototype,"Game");var ScenePlay=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.loadScene=function(){new BlockLine,new Game,new Score},e.prototype.update=function(){},e}(GameObject);__reflect(ScenePlay.prototype,"ScenePlay");var SceneTitle=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.startButton=null,e.settingsButton=null,e.texts[0]=Util.newTextField("ナンプレ",Util.width/9,FontColor,.5,.25,!0,!0),new InputField(81,20,FontColor,.5,.5,.9,.05,RelateBoxColor,1,e.inputData),e.startButton=new Button("スタート",Util.width/16,BackColor,.5,.7,.7,.12,FontColor,1,-1,!0,e.onTapStart,e),e.texts.forEach(function(t){t&&GameObject.baseDisplay.addChild(t)}),e}return __extends(e,t),e.loadScene=function(){new e},e.prototype.onDestroy=function(){this.texts.forEach(function(t){t&&t.parent.removeChild(t)}),this.texts=null},e.prototype.inputData=function(t){Game.initialData=t},e.prototype.update=function(){},e.prototype.onTapStart=function(){GameObject.transit=ScenePlay.loadScene},e}(GameObject);__reflect(SceneTitle.prototype,"SceneTitle");var Button=function(t){function e(e,o,n,i,r,a,s,l,c,u,h,p,d,f){void 0===f&&(f=0);var y=t.call(this)||this;return y.text=null,y.onTap=null,y.thisObject=null,y.keyId=0,y.press=!1,y.touch=!1,y.x=0,y.y=0,y.lineRgb=u,y.rgb=l,y.alpha=c,y.xr=i,y.yr=r,y.wr=a,y.hr=s,y.fontSize=o,y.fontRgb=n,y.setDisplay(u,l,c,i,r,a,s),e&&y.setText(e,!0),y.onTap=p,y.thisObject=d,y.keyId=f,y.onTap&&y.display.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){return y.onTap(y)},y.thisObject),y.display.addEventListener(egret.TouchEvent.TOUCH_BEGIN,y.touchBegin,y),y.display.addEventListener(egret.TouchEvent.TOUCH_MOVE,y.touchMove,y),y.display.addEventListener(egret.TouchEvent.TOUCH_END,y.touchEnd,y),y}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;this.onTap&&this.display.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){return t.onTap(t)},this.thisObject),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.text&&GameObject.baseDisplay.removeChild(this.text)},e.prototype.setDisplay=function(t,e,o,n,i,r,a){var s=this.display;null==s?(this.display=s=new egret.Shape,GameObject.baseDisplay.addChild(s)):s.graphics.clear(),t>=0?s.graphics.lineStyle(2,t):s.graphics.lineStyle(0),s.graphics.beginFill(e,o);var l=r*Util.width,c=a*Util.height;s.graphics.drawRoundRect(-.5*l,-.5*c,l,c,.1*c),s.graphics.endFill(),s.touchEnabled=!0,s.x=n*Util.width,s.y=i*Util.height,this.display=s},e.prototype.setColor=function(t){this.setDisplay(this.lineRgb,t,this.alpha,this.xr,this.yr,this.wr,this.hr)},e.prototype.setText=function(t,e){if(null==this.text)this.text=Util.newTextField(t,this.fontSize,this.fontRgb,this.xr,this.yr,e,!1),GameObject.baseDisplay.addChild(this.text);else{var o=this.text;this.text.text=t,o.x=Util.width*this.xr-.5*o.width,o.y=Util.height*this.yr-.5*o.height}},e.prototype.setTextColor=function(t){this.text&&(this.text.textColor=t)},e.prototype.update=function(){var t=this.touch?1.1:1;this.display.scaleX=this.display.scaleY=this.display.scaleX+.25*(t-this.display.scaleX),this.press=!1},e.prototype.touchBegin=function(t){this.x=t.stageX,this.y=t.stageY,this.press=!0,this.touch=!0},e.prototype.touchMove=function(t){this.x=t.stageX,this.y=t.stageY,this.touch=!0},e.prototype.touchEnd=function(t){this.touch=!1},e}(GameObject);__reflect(Button.prototype,"Button");var Camera2D=function(){function t(){}return t.initial=function(){t.x=0,t.y=0,t.localX=0,t.localY=0,t.scale=1,t.rotation=0},t.process=function(){GameObject.gameDisplay.anchorOffsetX=t.x,GameObject.gameDisplay.anchorOffsetY=t.y,GameObject.gameDisplay.x=this.localX,GameObject.gameDisplay.y=this.localY,GameObject.gameDisplay.scaleX=GameObject.gameDisplay.scaleY=t.scale,GameObject.gameDisplay.rotation=t.rotation},t}();__reflect(Camera2D.prototype,"Camera2D");var BlockLine=function(t){function e(){var e=t.call(this)||this,o=new egret.Shape;e.display=o,GameObject.baseDisplay.addChild(o),o.graphics.lineStyle(5,5263440);3*Util.w(BoxWpw),3*Util.h(BoxHph);return e.setRectLine(o,1,1),e.setRectLine(o,4,1),e.setRectLine(o,7,1),e.setRectLine(o,1,4),e.setRectLine(o,4,4),e.setRectLine(o,7,4),e.setRectLine(o,1,7),e.setRectLine(o,4,7),e.setRectLine(o,7,7),e}return __extends(e,t),e.prototype.setRectLine=function(t,e,o){var n=Util.w(.5+(e-4)*BoxWpw),i=Util.h(.35+(o-4)*BoxHph),r=3*Util.w(BoxWpw),a=3*Util.h(BoxHph);t.graphics.drawRect(n-.5*r,i-.5*a,r,a)},e.prototype.onDestroy=function(){},e.prototype.update=function(){},e}(GameObject);__reflect(BlockLine.prototype,"BlockLine");var InputField=function(t){function e(e,o,n,i,r,a,s,l,c,u){var h=t.call(this)||this;h.text=null,h.onChange=null;var p=new egret.Shape;GameObject.baseDisplay.addChild(p),p.graphics.beginFill(l,c);var d=a*Util.width,f=s*Util.height;return p.graphics.drawRoundRect(-.5*d,-.5*f,d,f,.4*f),p.graphics.endFill(),p.touchEnabled=!0,p.x=i*Util.width,p.y=r*Util.height,h.display=p,h.text=new egret.TextField,h.text.type=egret.TextFieldType.INPUT,h.text.maxChars=e,h.text.size=o,h.text.textColor=n,h.text.width=d,h.text.height=f,h.text.x=Util.width*i-.5*h.text.width+.5*o,h.text.y=Util.height*r-.5*o,GameObject.baseDisplay.addChild(h.text),h.onChange=u,h.onChange&&h.text.addEventListener(egret.Event.CHANGE,function(){return h.onChange(h.text.text)},h),h}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.baseDisplay.removeChild(this.text)},e.prototype.update=function(){},e}(GameObject);__reflect(InputField.prototype,"InputField");var Random=function(){function t(e){void 0===e&&(e=Math.floor(Math.random()*t.max)),this.x=123456789,this.y=362436069,this.z=521288629,this.w=e}return t.prototype["int"]=function(){return this.next()&t.max},t.prototype.f01=function(){return this["int"]()/(t.max+1)},t.prototype.f=function(t,e){return t+this.f01()*(e-t)},t.prototype.i=function(t,e){return Math.floor(this.f(t,e))},t.prototype.bool=function(t){return void 0===t&&(t=.5),this.f01()<t},t.prototype.next=function(){var t;return t=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(t^t>>>8)},t.max=1073741823,t}();__reflect(Random.prototype,"Random");var globalRandom=new Random,Rect=function(t){function e(e,o,n,i,r,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);var l=t.call(this)||this,c=new egret.Shape;l.display=c;var u=a?GameObject.gameDisplay:GameObject.baseDisplay;return s?u.addChild(l.display):u.addChildAt(l.display,1),c.graphics.beginFill(r,1),c.graphics.drawRect(e,o,n,i),c.graphics.endFill(),l}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Rect.prototype,"Rect");var Util=function(){function t(){}return t.w=function(e){return e*t.width},t.h=function(e){return e*t.height},t.initial=function(t){this.width=t.stage.stageWidth,this.height=t.stage.stageHeight},t["break"]=function(t,e){t&&console.log(e)},t.clamp=function(t,e,o){return e>t&&(t=e),t>o&&(t=o),t},t.clamp01=function(e){return t.clamp(e,0,1)},t.lerp=function(t,e,o){return t+(e-t)*o},t.deltaAngle=function(t){var e=(t+Math.PI)/(2*Math.PI);return e=65536*e&65535,e=e/65536*Math.PI*2-Math.PI},t.color=function(t,e,o){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*o)},t.colorLerp=function(t,e,o){var n=1-o,i=((16711680&t)*n+(16711680&e)*o&16711680)+((65280&t)*n+(65280&e)*o&65280)+((255&t)*n+(255&e)*o&255);return i},t.newTextField=function(e,o,n,i,r,a,s){var l=new egret.TextField;return l.text=e,l.bold=a,l.size=o,l.textColor=n,s?(l.x=(t.width-l.width)*i,l.y=(t.height-l.height)*r):(l.x=t.width*i-.5*l.width,l.y=t.height*r-.5*l.height),l},t.newShadowText=function(t,e,o){void 0===o&&(o=1.5);var n=new egret.TextField;return n.text=t.text,n.bold=t.bold,n.size=t.size,n.textColor=e,n.x=t.x+o,n.y=t.y+o,n.alpha=.5,n},t.newBitmap=function(t,e,o,n){var i=new egret.Bitmap;return i.texture=RES.getRes(t),GameObject.baseDisplay.addChild(i),i.x=e,i.y=o,i.anchorOffsetX=.5*i.width,i.anchorOffsetY=.5*i.height,i.scaleX=i.scaleY=n,i},t.getSaveDataNumber=function(t,e){var o=egret.localStorage.getItem(t),n=e;return null!=o&&(n=parseInt(o)),n},t.setSaveDataNumber=function(t,e){egret.localStorage.setItem(t,""+e)},t.getSaveDataString=function(t,e){var o=egret.localStorage.getItem(t);return null==o&&(o=e),o},t.setSaveDataString=function(t,e){egret.localStorage.setItem(t,e)},t}();__reflect(Util.prototype,"Util");var GameOver=function(t){function e(){var o=t.call(this)||this;return o.texts=[],o.retryButton=null,o.step=0,o.fadeInFrame=64,e.I=o,o.texts[0]=Util.newTextField("CLEAR!!",Util.width/12,Font2Color,.5,.3,!0,!1),egret.Tween.get(o.texts[0],{loop:!1}).to({alpha:0},0).to({alpha:1},1e3),GameObject.baseDisplay.addChild(o.texts[0]),o}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.baseDisplay.removeChild(t)}),this.texts=null,e.I=null},e.prototype.update=function(){this.step++,this.step==this.fadeInFrame&&(this.retryButton=new Button("リトライ",Util.width/16,BackColor,.5,.55,.4,.1,Font2Color,1,-1,!0,this.onTapRetry,this),Score.I.point>Score.I.bestScore&&(Util.setSaveDataNumber(SaveKeyBestScore,Score.I.point),this.texts[1]=Util.newTextField("NEW RECORD!",Util.width/13,Font2Color,.5,.4,!0,!1),egret.Tween.get(this.texts[1],{loop:!0}).to({alpha:0},500).to({alpha:1},500),GameObject.baseDisplay.addChild(this.texts[1])))},e.prototype.onTapRetry=function(){GameObject.transit=ScenePlay.loadScene},e.I=null,e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Score=function(t){function e(){var o=t.call(this)||this;return o.point=0,o.bestScore=0,o.text=null,e.I=o,o.point=0,o.text=Util.newTextField("",Util.width/22,Font2Color,0,0,!0,!0),GameObject.baseDisplay.addChild(o.text),o.bestScore=Util.getSaveDataNumber(SaveKeyBestScore,DefaultBestScore),o}return __extends(e,t),e.prototype.onDestroy=function(){this.text.parent.removeChild(this.text),this.text=null,e.I=null},e.prototype.update=function(){},e.prototype.addPoint=function(t){void 0===t&&(t=1),this.setPoint(this.point+t)},e.prototype.setPoint=function(t){var e=this.point.toFixed(),o=t.toFixed();this.point=t,e!=o&&(this.text.text=""+o)},e.I=null,e}(GameObject);__reflect(Score.prototype,"Score");var StartMessage=function(t){function e(){var o=t.call(this)||this;return o.rectFilter=null,o.texts=[],o.button=null,e.I=o,o.rectFilter=new Rect(0,Util.h(.325),Util.width,Util.h(.3),0,!1,!0),o.rectFilter.display.alpha=.4,o.texts[0]=Util.newTextField("空いているマスをタップで選択",Util.width/20,FontColor,.5,.4,!0,!1),o.texts[1]=Util.newTextField("下の１〜９の数字キーで入力しよう",Util.width/20,FontColor,.5,.5,!0,!1),o.texts.forEach(function(t){GameObject.baseDisplay.addChild(t)}),o.button=new Button(null,0,0,.5,.5,1,1,0,0,-1,!0,o.onTap,o),o}return __extends(e,t),e.prototype.onDestroy=function(){this.rectFilter.destroy(),this.rectFilter=null,this.texts.forEach(function(t){t.parent.removeChild(t)}),this.texts=null,this.button.destroy(),e.I=null},e.prototype.update=function(){},e.prototype.onTap=function(){e.I&&e.I.destroy()},e.I=null,e}(GameObject);__reflect(StartMessage.prototype,"StartMessage");